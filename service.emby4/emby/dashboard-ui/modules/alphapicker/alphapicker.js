define(["focusManager","layoutManager","dom","css!./style.css","paper-icon-button-light","material-icons"],function(focusManager,layoutManager,dom){"use strict";var selectedButtonClass="alphaPickerButton-selected";function focus(){var selected=this.querySelector("."+selectedButtonClass);selected?focusManager.focus(selected):focusManager.autoFocus(this)}function getAlphaPickerButtonClassName(vertical){var alphaPickerButtonClassName="alphaPickerButton";return layoutManager.tv&&(alphaPickerButtonClassName+=" alphaPickerButton-tv"),vertical&&(alphaPickerButtonClassName+=" alphaPickerButton-vertical"),alphaPickerButtonClassName}function mapLetters(letters,vertical){return letters.map(function(l){return function(l,vertical){return'<button is="emby-button" href="#" data-value="'+l+'" class="button-flat '+getAlphaPickerButtonClassName(vertical)+'">'+l+"</button>"}(l,vertical)})}function setInnerHtml(element,html){element.innerHTML=html,element.classList.add("focusable"),element.focus=focus}function onAlphaPickerFocusIn(e){this.alphaFocusTimeout&&(clearTimeout(this.alphaFocusTimeout),this.alphaFocusTimeout=null);var alphaPickerButton=dom.parentWithClass(e.target,"alphaPickerButton");alphaPickerButton&&(this.alphaFocusedElement=alphaPickerButton,this.alphaFocusTimeout=setTimeout(function(){if(this.alphaFocusTimeout=null,document.activeElement===this.alphaFocusedElement){var value=this.alphaFocusedElement.getAttribute("data-value");this.value(value,!0)}}.bind(this),600))}function AlphaPicker(options){this.options=options,this.bound_onAlphaPickerInKeyboardModeClick=function(e){var alphaPickerButton=dom.parentWithClass(e.target,"alphaPickerButton");if(alphaPickerButton){var value=alphaPickerButton.getAttribute("data-value");this.options.element.dispatchEvent(new CustomEvent("alphavalueclicked",{cancelable:!1,detail:{value:value}}))}}.bind(this),this.bound_onAlphaPickerFocusIn=onAlphaPickerFocusIn.bind(this),this.valueChangeEvent=layoutManager.tv?null:"click",function(element,options){element.classList.add("alphaPicker"),layoutManager.tv&&element.classList.add("alphaPicker-tv");var vertical=element.classList.contains("alphaPicker-vertical");vertical||element.classList.add("focuscontainer-x");var html="",alphaPickerButtonClassName=getAlphaPickerButtonClassName(vertical),rowClassName="alphaPickerRow";vertical&&(rowClassName+=" alphaPickerRow-vertical"),html+='<div class="'+rowClassName+'">',"keyboard"===options.mode?(html+='<button data-value=" " is="paper-icon-button-light" class="'+alphaPickerButtonClassName+'"><i class="md-icon alphaPickerButtonIcon">&#xE256;</i></button>',html+=mapLetters(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],vertical).join(""),html+='<button data-value="backspace" is="paper-icon-button-light" class="'+alphaPickerButtonClassName+'"><i class="md-icon alphaPickerButtonIcon">&#xE14A;</i></button>',html+="</div>",html+='<div class="'+rowClassName+'">',html+="<br/>",html+=mapLetters(["0","1","2","3","4","5","6","7","8","9"],vertical).join("")):html+=mapLetters(options.prefixes||["#","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],vertical).join(""),setInnerHtml(element,html+="</div>")}(options.element,options),this.enabled(!0),this.visible(!0)}return AlphaPicker.prototype.enabled=function(enabled){var fn,options=this.options,element=options.element;enabled?("keyboard"===options.mode&&element.addEventListener("click",this.bound_onAlphaPickerInKeyboardModeClick),"click"!==this.valueChangeEvent?element.addEventListener("focus",this.bound_onAlphaPickerFocusIn,!0):(fn=function(e){var alphaPickerButton=dom.parentWithClass(e.target,"alphaPickerButton");if(alphaPickerButton){var value=alphaPickerButton.getAttribute("data-value");this.value(value,!0)}}.bind(this),element.onAlphaPickerClickFn=fn,element.addEventListener("click",fn))):(element.removeEventListener("click",this.bound_onAlphaPickerInKeyboardModeClick),element.removeEventListener("focus",this.bound_onAlphaPickerFocusIn,!0),(fn=element.onAlphaPickerClickFn)&&(element.removeEventListener("click",fn),element.onAlphaPickerClickFn=null))},AlphaPicker.prototype.value=function(value,applyValue){var element=this.options.element;value=value.toUpperCase(),applyValue&&element.dispatchEvent(new CustomEvent("alphavaluechanged",{cancelable:!1,detail:{value:value}}))},AlphaPicker.prototype.on=function(name,fn){this.options.element.addEventListener(name,fn)},AlphaPicker.prototype.off=function(name,fn){this.options.element.removeEventListener(name,fn)},AlphaPicker.prototype.visible=function(visible){this.options.element.style.visibility=visible?"visible":"hidden"},AlphaPicker.prototype.setPrefixes=function(prefixes){var element=this.options.element,html=mapLetters(prefixes,element.classList.contains("alphaPicker-vertical")).join("");element.querySelector(".alphaPickerRow").innerHTML=html},AlphaPicker.prototype.values=function(){for(var elems=this.options.element.querySelectorAll(".alphaPickerButton"),values=[],i=0,length=elems.length;i<length;i++)values.push(elems[i].getAttribute("data-value"));return values},AlphaPicker.prototype.focus=function(){var element=this.options.element;focusManager.autoFocus(element)},AlphaPicker.prototype.destroy=function(){var element=this.options.element;this.enabled(!1),element.classList.remove("focuscontainer-x"),this.itemFocusValue=null,this.options=null,this.valueChangeEvent=null,this.bound_onAlphaPickerInKeyboardModeClick=null,this.bound_onAlphaPickerFocusIn=null},AlphaPicker});