# -*- coding: utf-8 -*-
import base64
from core import httptools, scrapertools, jsontools
from platformcode import logger
from lib import balandroresolver

def get_video_url(page_url, url_referer=''):
    logger.info("url=" + page_url)
    video_urls = []

    vid = scrapertools.find_single_match(page_url, "uptostream.com/(?:iframe/|)([A-z0-9]+)")
    if not vid: return video_urls
    #data = httptools.downloadpage('https://uptostream.com/api/streaming/source/get?token=null&file_code='+vid).data
    data = """var _0x481a=[];var _0x5071=function(_0x28ead1,_0x238349){_0x28ead1=_0x28ead1-0x6a;var _0x481a61=_0x481a[_0x28ead1];if(_0x5071['rJFbpm']===undefined){var _0x507127=function(_0x2cc15b){var _0x4fd9d2='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x2a67d6='';for(var _0x33e83=0x0,_0x16cabf,_0x2a8075,_0x10a6de=0x0;_0x2a8075=_0x2cc15b['charAt'](_0x10a6de++);~_0x2a8075&&(_0x16cabf=_0x33e83%0x4?_0x16cabf*0x40+_0x2a8075:_0x2a8075,_0x33e83++%0x4)?_0x2a67d6+=String['fromCharCode'](0xff&_0x16cabf>>(-0x2*_0x33e83&0x6)):0x0){_0x2a8075=_0x4fd9d2['indexOf'](_0x2a8075);}return _0x2a67d6;};var _0x6e8c24=function(_0x24a1aa,_0x2b89b6){var _0x196f76=[],_0x911eae=0x0,_0x2dc7b4,_0x391207='',_0x2e9d5e='';_0x24a1aa=_0x507127(_0x24a1aa);for(var _0x2b8b6d=0x0,_0x35909c=_0x24a1aa['length'];_0x2b8b6d<_0x35909c;_0x2b8b6d++){_0x2e9d5e+='%'+('00'+_0x24a1aa['charCodeAt'](_0x2b8b6d)['toString'](0x10))['slice'](-0x2);}_0x24a1aa=decodeURIComponent(_0x2e9d5e);var _0x1e805;for(_0x1e805=0x0;_0x1e805<0x100;_0x1e805++){_0x196f76[_0x1e805]=_0x1e805;}for(_0x1e805=0x0;_0x1e805<0x100;_0x1e805++){_0x911eae=(_0x911eae+_0x196f76[_0x1e805]+_0x2b89b6['charCodeAt'](_0x1e805%_0x2b89b6['length']))%0x100,_0x2dc7b4=_0x196f76[_0x1e805],_0x196f76[_0x1e805]=_0x196f76[_0x911eae],_0x196f76[_0x911eae]=_0x2dc7b4;}_0x1e805=0x0,_0x911eae=0x0;for(var _0x465748=0x0;_0x465748<_0x24a1aa['length'];_0x465748++){_0x1e805=(_0x1e805+0x1)%0x100,_0x911eae=(_0x911eae+_0x196f76[_0x1e805])%0x100,_0x2dc7b4=_0x196f76[_0x1e805],_0x196f76[_0x1e805]=_0x196f76[_0x911eae],_0x196f76[_0x911eae]=_0x2dc7b4,_0x391207+=String['fromCharCode'](_0x24a1aa['charCodeAt'](_0x465748)^_0x196f76[(_0x196f76[_0x1e805]+_0x196f76[_0x911eae])%0x100]);}return _0x391207;};_0x5071['MzSgOt']=_0x6e8c24,_0x5071['gyZBqc']={},_0x5071['rJFbpm']=!![];}var _0x30cb85=_0x481a[0x0],_0x3fb03d=_0x28ead1+_0x30cb85,_0x286014=_0x5071['gyZBqc'][_0x3fb03d];return _0x286014===undefined?(_0x5071['rBnllV']===undefined&&(_0x5071['rBnllV']=!![]),_0x481a61=_0x5071['MzSgOt'](_0x481a61,_0x238349),_0x5071['gyZBqc'][_0x3fb03d]=_0x481a61):_0x481a61=_0x286014,_0x481a61;};var _0x3ac0fb=_0x5071;(function(_0x46539a,_0x3ebf0c){var _0x4c24ad=_0x5071;while(!![]){try{var _0x18d5b8=parseInt(_0x4c24ad(0xc9,'OCfc'))*parseInt(_0x4c24ad(0x9d,'06J['))+-parseInt(_0x4c24ad(0xe0,'WKD*'))+parseInt(_0x4c24ad(0x6a,'241Y'))*parseInt(_0x4c24ad(0xb8,'OCfc'))+parseInt(_0x4c24ad(0x96,'241Y'))*parseInt(_0x4c24ad(0xbc,'E^#V'))+parseInt(_0x4c24ad(0x92,'x^yi'))*parseInt(_0x4c24ad(0xc4,')fU0'))+parseInt(_0x4c24ad(0xc5,'7(6R'))+-parseInt(_0x4c24ad(0x6b,'Mxzn'));if(_0x18d5b8===_0x3ebf0c)break;else _0x46539a['push'](_0x46539a['shift']());}catch(_0x14557a){_0x46539a['push'](_0x46539a['shift']());}}}(_0x481a,0x87a6e));var sources=[];;sources[_0x3ac0fb(0x94,']H#X')](function setTheLink(){var _0x70633e=_0x3ac0fb,_0x25bf2a={'FtwAB':'https://'+_0x70633e(0xce,'2hTO')+'8.up'+_0x70633e(0xb4,'&q9C')+_0x70633e(0xd7,'C!ry')+_0x70633e(0xf3,'&HNz'),'Daxmq':_0x70633e(0xdb,'Js*B')+'8723'+_0x70633e(0x9b,'x^yi'),'iRyWE':_0x70633e(0xb5,'0UaC'),'ZhXFY':function(_0x3f9deb,_0x8c9cbe){return _0x3f9deb===_0x8c9cbe;},'tNJmE':_0x70633e(0x9a,'iBu(')+'t','KsvkY':_0x70633e(0xd6,'qrI8')+'F','TAseh':'spa','yvnmj':function(_0x23c230,_0x3a10f1){return _0x23c230===_0x3a10f1;},'jCzbg':_0x70633e(0xa0,'iwe(')+'k','ymPwE':_0x70633e(0xf2,'1l5D')+_0x70633e(0xd3,'Dv$k')+'4','jLVfz':function(_0x2018cf,_0x541a9c){return _0x2018cf+_0x541a9c;},'XPucc':function(_0x3d784e,_0x3641eb){return _0x3d784e+_0x3641eb;},'fvJhL':function(_0x3ea862){return _0x3ea862();},'sbbba':function(_0x24f311){return _0x24f311();},'QGfgw':'720p','VmJnq':'unkn'+_0x70633e(0x6c,'0UaC')+'0'},_0x1bb22d=function(){var _0x3ac51a=_0x70633e;return _0x25bf2a[_0x3ac51a(0xa1,'$^z$')+'B'];},_0x4c3a0b=function(){var _0x5fb0f8=_0x70633e;return _0x25bf2a[_0x5fb0f8(0x82,'O26t')+'q'];},_0x107b96=function(){var _0x1c444a=_0x70633e;return _0x25bf2a[_0x1c444a(0x7f,'Dv$k')+'E'];};function _0x19d806(){var _0x2117b8=_0x70633e;if(_0x25bf2a[_0x2117b8(0xd8,'&Z$o')+'Y'](_0x25bf2a[_0x2117b8(0x95,'bk79')+'E'],_0x25bf2a[_0x2117b8(0xc2,'bk79')+'Y'])){function _0x53f59b(){var _0x54e822=_0x2117b8;return _0x54e822(0xa7,'6n6D');}}else return _0x25bf2a['TAseh'];}function _0xc14445(){return'0';}var _0x17f25b=function(){var _0x52eee2=_0x70633e;if(_0x25bf2a['yvnmj'](_0x25bf2a['jCzbg'],_0x25bf2a['jCzbg']))return _0x25bf2a[_0x52eee2(0xac,'*a#4')+'E'];else{function _0x2ec451(){var _0x3fb2ae=_0x52eee2;return _0x25bf2a[_0x3fb2ae(0xd0,'0UaC')+'q'];}}};let _0x4db6b8={};var _0x34ea9c=_0x25bf2a['jLVfz'](_0x25bf2a[_0x70633e(0x76,'WKD*')+'z'](_0x25bf2a['jLVfz'](_0x25bf2a[_0x70633e(0xd2,'bk79')+'z'](_0x25bf2a['XPucc'](_0x25bf2a[_0x70633e(0x84,'WbgK')+'c'](_0x1bb22d(),'/')+_0x25bf2a[_0x70633e(0xd5,'gytn')+'L'](_0x4c3a0b),'/'),_0x25bf2a[_0x70633e(0xf0,'O26t')+'L'](_0x107b96))+'/',_0x25bf2a['sbbba'](_0xc14445)),'/'),_0x25bf2a[_0x70633e(0x6f,']H#X')+'a'](_0x17f25b)),_0x4d3784='vide'+_0x70633e(0x91,'^sph')+'4',_0xb1dbfb=_0x25bf2a[_0x70633e(0x7d,'O26t')+'w'],_0x1985a0=_0x25bf2a[_0x70633e(0xdc,'1l5D')+'E'],_0x502bdd=_0x25bf2a[_0x70633e(0xc1,'dAlT')+'q'],_0x1f6a93='0';return _0x4db6b8[_0x70633e(0xd4,'&q9C')]=_0x34ea9c,_0x4db6b8[_0x70633e(0x78,'iwe(')]=_0x4d3784,_0x4db6b8[_0x70633e(0x83,'4wl@')+'l']=_0xb1dbfb,_0x4db6b8[_0x70633e(0x74,'8PB*')]=_0x1985a0,_0x4db6b8[_0x70633e(0xef,'x^yi')]=_0x25bf2a[_0x70633e(0xf1,'hI0B')+'h'],_0x4db6b8[_0x70633e(0xa5,'C!ry')+'ng']=_0x1f6a93,_0x4db6b8;}()),sources[_0x3ac0fb(0xa6,'7(6R')](function setTheLink(){var _0x53443d=_0x3ac0fb,_0x52885c={'rBKas':_0x53443d(0xe6,'aBP9'),'dWqpM':function(_0x4b634f,_0x4331d3){return _0x4b634f===_0x4331d3;},'eNMto':_0x53443d(0xda,'OCfc')+'o','qYCzo':_0x53443d(0xab,'^sph')+'o','xMzOm':'https://www38.uptostream.com','pZfhR':_0x53443d(0xe4,'iBu(')+_0x53443d(0x7c,'qrI8')+_0x53443d(0x9c,'1l5D'),'kOWvm':_0x53443d(0xaf,'^sph'),'QkMIh':_0x53443d(0x70,'%#F['),'gWowx':_0x53443d(0x7b,'E^#V')+'e','rDjwj':_0x53443d(0xb6,'iwe(')+'h','mHfus':'vide'+_0x53443d(0x73,'2hTO')+'4','xlksg':function(_0x16c601,_0x59187a){return _0x16c601+_0x59187a;},'BBzoQ':function(_0x5e6666,_0x41f708){return _0x5e6666+_0x41f708;},'cNAWK':function(_0x37a2ba,_0x63a3d8){return _0x37a2ba+_0x63a3d8;},'iPnGq':function(_0x2f233d,_0x47ae79){return _0x2f233d+_0x47ae79;},'XGnNe':function(_0x3b8689){return _0x3b8689();},'sCiya':function(_0x6c9754){return _0x6c9754();},'HLZrY':function(_0x282e90){return _0x282e90();},'EbqEY':_0x53443d(0x90,'J(o2')+_0x53443d(0xbe,'4wl@')+'4','BVool':'480p'},_0x5a9976=function(){var _0x544080=_0x53443d,_0xe86e8a={'fYTvl':_0x52885c[_0x544080(0xd1,'Ag2N')+'s']};if(_0x52885c['dWqpM'](_0x52885c['eNMto'],_0x52885c[_0x544080(0x9f,'%#F[')+'o'])){function _0x270c55(){var _0x319a67=_0x544080;return _0xe86e8a[_0x319a67(0x71,'bSvu')+'l'];}}else return _0x52885c[_0x544080(0x97,'d4&!')+'m'];},_0x5c3bee=function(){var _0x4016cb=_0x53443d;return _0x52885c[_0x4016cb(0xdd,'Ag2N')+'R'];},_0x11b5eb=function(){var _0x3d8b11=_0x53443d;return _0x52885c[_0x3d8b11(0x7e,'Bewy')+'m'];};function _0x2068f(){var _0xed38cd=_0x53443d;return _0x52885c[_0xed38cd(0xc8,'iwe(')+'h'];}function _0x129f09(){var _0x159f48=_0x53443d;if(_0x52885c[_0x159f48(0x86,'$^z$')+'x']===_0x52885c[_0x159f48(0x8c,'WbgK')+'j']){function _0x53201b(){return'0';}}else return'0';}var _0x31753c=function(){var _0xf7799b=_0x53443d;return _0x52885c[_0xf7799b(0xb0,'gytn')+'s'];};let _0x200dcd={};var _0x9e85ac=_0x52885c[_0x53443d(0xa8,'8PB*')+'g'](_0x52885c['BBzoQ'](_0x52885c[_0x53443d(0x98,'UoDw')+'K'](_0x52885c['iPnGq'](_0x52885c[_0x53443d(0xcb,'Ag2N')+'q'](_0x52885c['iPnGq'](_0x52885c[_0x53443d(0xcd,'qrI8')+'e'](_0x5a9976),'/'),_0x52885c['sCiya'](_0x5c3bee)),'/'),_0x52885c[_0x53443d(0x6d,'x^yi')+'a'](_0x11b5eb))+'/',_0x52885c[_0x53443d(0xb2,'$^z$')+'Y'](_0x129f09))+'/',_0x31753c()),_0x4a9886=_0x52885c[_0x53443d(0xe3,'Js*B')+'Y'],_0x34c908=_0x52885c[_0x53443d(0xba,'*a#4')+'l'],_0x245d8b=_0x52885c['kOWvm'],_0x4c52e5=_0x53443d(0x8d,'iBu(')+_0x53443d(0xad,'Bewy')+'0',_0x30ffb8='0';return _0x200dcd[_0x53443d(0x99,'Bewy')]=_0x9e85ac,_0x200dcd['type']=_0x4a9886,_0x200dcd[_0x53443d(0x81,'WbgK')+'l']=_0x34c908,_0x200dcd['res']=_0x245d8b,_0x200dcd['lang']=_0x53443d(0xd9,'J(o2'),_0x200dcd[_0x53443d(0x8b,'Bewy')+'ng']=_0x30ffb8,_0x200dcd;}()),sources[_0x3ac0fb(0xbb,'1l5D')](function setTheLink(){var _0x48bee6=_0x3ac0fb,_0xf1dae4={'WjLAa':_0x48bee6(0x79,'iBu(')+_0x48bee6(0x75,'6n6D')+_0x48bee6(0xea,'l3ux')+_0x48bee6(0x8f,']H#X')+'tost'+_0x48bee6(0x8e,'WKD*')+'.com','wGnrV':'video.mp4','cvsPu':function(_0x563bad,_0x2faef6){return _0x563bad===_0x2faef6;},'vZluw':_0x48bee6(0xed,']H#X')+'Q','rPhUO':'rZyke','aRXwy':_0x48bee6(0x6e,'hI0B')+_0x48bee6(0xde,'4wl@')+_0x48bee6(0xbf,'UoDw'),'lKZVs':function(_0x17b30b,_0x60f6c7){return _0x17b30b===_0x60f6c7;},'uIyiG':_0x48bee6(0xc0,']H#X')+'r','mHzwi':_0x48bee6(0xa9,'AL55')+'O','oENUC':'360','LgoCL':_0x48bee6(0xe5,'Mxzn'),'gwZvO':_0x48bee6(0xf8,'&Z$o')+'X','BJEDX':function(_0x3138de,_0x5d3d31){return _0x3138de+_0x5d3d31;},'lUecQ':function(_0x30103e,_0x151a45){return _0x30103e+_0x151a45;},'bNdPW':function(_0x2b64b8,_0x19e829){return _0x2b64b8+_0x19e829;},'YOxqX':function(_0x1c2cbf,_0x31f10e){return _0x1c2cbf+_0x31f10e;},'tlvTS':function(_0x441384){return _0x441384();},'GVlTK':function(_0x478c2a){return _0x478c2a();},'IHeDi':_0x48bee6(0x9e,'4wl@')+'o/mp4','Gpvih':_0x48bee6(0x8a,'8PB*'),'tXPvL':_0x48bee6(0x88,'2hTO')+_0x48bee6(0xcc,'Dv$k')+'0'},_0x3be819=function(){var _0x3a3868=_0x48bee6;return _0xf1dae4[_0x3a3868(0xee,'d4&!')+'a'];},_0x31937b=function(){var _0x44946f=_0x48bee6,_0x226565={'WwXbW':_0xf1dae4[_0x44946f(0x87,'Mxzn')+'V']};if(_0xf1dae4['cvsPu'](_0xf1dae4['vZluw'],_0xf1dae4[_0x44946f(0xf7,'dAlT')+'O'])){function _0xd0da0(){return _0x226565['WwXbW'];}}else return _0xf1dae4['aRXwy'];},_0x5a59e0=function(){var _0x1424fc=_0x48bee6;if(_0xf1dae4[_0x1424fc(0x93,'UoDw')+'s'](_0xf1dae4['uIyiG'],_0xf1dae4['mHzwi'])){function _0xf14f56(){var _0x239ccb=_0x1424fc;return _0xf1dae4[_0x239ccb(0xe9,'*a#4')+'a'];}}else return _0xf1dae4[_0x1424fc(0xca,'06J[')+'C'];};function _0x2df502(){var _0x3cd6cc=_0x48bee6;return _0xf1dae4[_0x3cd6cc(0xaa,'8PB*')+'L'];}function _0x31628e(){var _0x341183=_0x48bee6,_0x1225ca={'BAWbk':_0xf1dae4[_0x341183(0xbd,'Dv$k')+'L']};if(_0xf1dae4[_0x341183(0xf5,'%#F[')+'O']==='yuRRO'){function _0x4f4c01(){var _0x9cc2d5=_0x341183;return _0x1225ca[_0x9cc2d5(0xf6,'d4&!')+'k'];}}else return'0';}var _0x4ff413=function(){var _0x4113a4=_0x48bee6;return _0xf1dae4[_0x4113a4(0xc6,'2hTO')+'V'];};let _0x431fa8={};var _0xb7c750=_0xf1dae4['BJEDX'](_0xf1dae4[_0x48bee6(0xb7,'7(6R')+'Q'](_0xf1dae4[_0x48bee6(0xae,'Mxzn')+'W'](_0xf1dae4['bNdPW'](_0xf1dae4[_0x48bee6(0xf4,'7(6R')+'X'](_0xf1dae4[_0x48bee6(0xe1,'xXQ7')+'S'](_0x3be819),'/'),_0xf1dae4[_0x48bee6(0xec,')D(b')+'K'](_0x31937b)),'/')+_0xf1dae4['GVlTK'](_0x5a59e0),'/'),_0xf1dae4[_0x48bee6(0xe7,'%#F[')+'K'](_0x31628e))+'/'+_0xf1dae4[_0x48bee6(0xe8,'Mxzn')+'K'](_0x4ff413),_0x2270c6=_0xf1dae4['IHeDi'],_0x3b2bfa=_0xf1dae4['Gpvih'],_0xb1cb5a=_0xf1dae4[_0x48bee6(0xeb,'bk79')+'C'],_0x28339c=_0xf1dae4[_0x48bee6(0xb3,'&q9C')+'L'],_0x182203='0';return _0x431fa8[_0x48bee6(0xc3,'bSvu')]=_0xb7c750,_0x431fa8[_0x48bee6(0xb1,'Js*B')]=_0x2270c6,_0x431fa8[_0x48bee6(0xdf,'%4aK')+'l']=_0x3b2bfa,_0x431fa8[_0x48bee6(0xa4,'hI0B')]=_0xb1cb5a,_0x431fa8[_0x48bee6(0xa2,'WbgK')]=_0xf1dae4[_0x48bee6(0x72,'&Z$o')+'L'],_0x431fa8[_0x48bee6(0x77,'Dv$k')+'ng']=_0x182203,_0x431fa8;}());"""
    matches = balandroresolver.decode_video_uptostream(data)
    logger.info(matches)
    for match in matches:
        lbl = match.get('label')
        url = match.get('src')
        video_urls.append([lbl, url])
    return video_urls

